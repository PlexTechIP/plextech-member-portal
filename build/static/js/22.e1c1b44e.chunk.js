"use strict";(self.webpackChunkplexfinance=self.webpackChunkplexfinance||[]).push([[22],{58574:(e,n,t)=>{t.d(n,{A:()=>m});var a=t(5446),s=t(2235),r=t(88981),i=t(25333),c=t(9950),l=t(4804),d=t(54975),o=t(44414);function m(e){return(0,c.useEffect)((()=>{console.warn(e.error)})),(0,o.jsx)(a.A,{open:e.open,className:"w-1/2 min-w-[500px] h-full absolute inset-0 m-auto p-16",children:(0,o.jsx)(s.A,{className:"p-12 !rounded-[48px]",children:(0,o.jsxs)(r.A,{spacing:2,children:[(0,o.jsxs)(r.A,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,o.jsxs)("h1",{className:"m-0",children:["Error",e.error.errorCode&&" ".concat(e.error.errorCode),":"," ",e.error.errorMessage]}),(0,o.jsx)(i.A,{onClick:()=>{window.location.reload()},children:(0,o.jsx)(l.A,{})})]}),(0,o.jsxs)("p",{className:"m-0",children:["Try refreshing the page and contact"," ",(0,o.jsx)("a",{href:"mailto:shamith09@berkeley.edu?subject=[Plexfinance Error]",children:"shamith09@berkeley.edu"})," ","if the issue persists."]}),(0,o.jsx)("img",{src:d.kD,alt:"error"})]})})})}},96022:(e,n,t)=>{t.r(n),t.d(n,{AttendancePage:()=>R});var a=t(89379),s=t(58574),r=t(9950),i=t(76455),c=t(4159),l=t.n(c),d=t(84732),o=t(25925),m=t(32459),x=t(88981),h=t(2235),u=t(2257),j=t(75165),p=t(46639),A=t(16497),g=t(93038),w=t(53872),f=t(64068),v=t(42891),y=t(60899),b=t(40165),N=t(48089),C=t(53777),I=t(44414);function S(e){const{attendees:n,startTime:t}=e;return(0,I.jsx)(h.A,{className:"min-h-[95%] w-[60%] min-w-[500px] mx-auto p-16 !rounded-[48px]",children:(0,I.jsxs)(x.A,{spacing:3,alignItems:"center",children:[(0,I.jsxs)(x.A,{spacing:1,alignItems:"center",direction:"row",justifyContent:"space-between",className:"w-full",children:[(0,I.jsx)("h1",{className:"m-0",children:"Attendees"}),(0,I.jsxs)(x.A,{spacing:1,direction:"row",alignItems:"center",children:[(0,I.jsx)(C.A,{className:"text-gray-500 text-sm"}),(0,I.jsx)("p",{className:"m-0 text-gray-500",children:"Scan the QR code and log in to mark yourself present."})]})]}),(0,I.jsx)(y.Ay,{container:!0,spacing:1,children:Object.keys(n).map((e=>{if("Manual"===n[e][0])return(0,I.jsx)(b.A,{in:!0,children:(0,I.jsx)(y.Ay,{item:!0,xs:6,children:(0,I.jsx)(N.A,{className:"p-6 !rounded-[24px] w-full text-center ".concat(n[e][2]?"bg-[rgba(255,138,0,0.3)]":""),children:(0,I.jsx)("h3",{className:"m-0",children:n[e][1]})})})},e);{const[a,s,r]=n[e][0].split(":"),i=n[e][0].includes("PM"),c=l()().hour(parseInt(a)%12+(i?12:0)).minute(parseInt(s)).second(parseInt(r));return(0,I.jsx)(b.A,{in:!0,children:(0,I.jsx)(y.Ay,{item:!0,xs:6,children:(0,I.jsx)(N.A,{className:"p-6 !rounded-[24px] w-full text-center ".concat(c>t?"bg-[rgba(255,138,0,0.3)]":""),children:(0,I.jsxs)("h3",{className:"m-0",children:[n[e][1]," - ",n[e][0]]})})})},e)}}))})]})})}var T=t(54975);function k(e){var n;if(402===(null===(n=e.error)||void 0===n?void 0:n.errorCode))return(0,I.jsx)(h.A,{className:"min-h-[95%] w-1/2 min-w-[700px] mx-auto p-16 !rounded-[48px] mt-8",children:(0,I.jsxs)(x.A,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,I.jsx)("h2",{className:"m-0",children:"Sorry! This code is invalid, please try scanning it again."}),(0,I.jsx)("img",{src:T.PJ,alt:"Plexie cold",className:"max-h-[200px]"})]})});const t=e=>{const[n,t,a]=e.split(":"),s=e.includes("PM");return l()().hour(parseInt(n)%12+(s?12:0)).minute(parseInt(t)).second(parseInt(a))},a=t(e.attendanceTime).isAfter(t(e.startTime));return(0,I.jsx)(h.A,{className:"min-h-[95%] w-1/2 min-w-[700px] mx-auto p-16 !rounded-[48px] mt-8",children:(0,I.jsx)(x.A,{spacing:2,children:(0,I.jsxs)(x.A,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,I.jsxs)(x.A,{spacing:1,children:[a?(0,I.jsx)("h2",{className:"m-0 text-red-500",children:"You are late!"}):(0,I.jsx)("h2",{className:"m-0 text-green-500",children:"You are on time!"}),(0,I.jsxs)("h2",{className:"m-0",children:["Code scanned at: ",e.attendanceTime]}),(0,I.jsxs)("h2",{className:"m-0",children:["Meeting start time: ",e.startTime]})]}),a?(0,I.jsx)("img",{src:T.vC,alt:"Plexie sad",className:"max-h-[200px]"}):(0,I.jsx)("img",{src:T.Dn,alt:"Plexie happy",className:"max-h-[200px]"})]})})})}var E=t(72301);function P(e){const{absent:n}=e;return(0,I.jsx)(h.A,{className:"min-h-[95%] w-[60%] min-w-[500px] mx-auto p-16 !rounded-[48px]",children:(0,I.jsxs)(x.A,{spacing:3,alignItems:"center",children:[(0,I.jsx)(x.A,{spacing:1,alignItems:"center",direction:"row",justifyContent:"space-between",className:"w-full",children:(0,I.jsx)("h1",{className:"m-0",children:"Absent"})}),(0,I.jsx)(y.Ay,{container:!0,spacing:1,children:n.map((e=>(0,I.jsx)(b.A,{in:!0,children:(0,I.jsx)(y.Ay,{item:!0,xs:6,children:(0,I.jsx)(N.A,{className:"p-6 !rounded-[24px] w-full text-center",children:(0,I.jsx)("h3",{className:"m-0",children:e})})})},e)))})]})})}var M=t(67956),O=t(49211);const L=30;function R(e){const[n,t]=(0,r.useState)("hi"),[c,y]=(0,r.useState)(""),[b,N]=(0,r.useState)({}),[C,T]=(0,r.useState)([]),[R,U]=(0,r.useState)(!1),[q,D]=(0,r.useState)(),[F,J]=(0,r.useState)(l()()),[V,B]=(0,r.useState)(""),[G,Y]=(0,r.useState)(),[z,H]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(L),[W,X]=(0,r.useState)(""),[$,_]=(0,r.useState)(!1),Z=async()=>{if(U(!0),z){H(!1);const[e,n]=await(0,f.A)("/attendance/","DELETE",{id:c});if(!e)return D(n.error),void H(!0);const a={attendees:Object.values(b).map((e=>e[1])),absent:C};await navigator.clipboard.writeText(JSON.stringify(a)),t(""),y(""),N([]),T([])}else{H(!0);const[e,n]=await(0,f.A)("/attendance/","POST",{name:V,meetingLeader:(0,v.A)((0,E.gf)()).sub,startTime:null===F||void 0===F?void 0:F.format("h:mm:ss A"),set:!0});if(!e)return D(n.error),void H(!1);t(n.code),y(n.id),N(n.attendees),T(n.absent)}U(!1)},ee=()=>{const e="Name,Arrival Time\n"+Object.values(b).map((e=>{const n=e[0],t=e[1];return"".concat(t,",").concat(n)})).join("\n"),n=new Blob([e],{type:"text/csv;charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download="attendees.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)},ne=new URLSearchParams(window.location.search),te=ne.get("attendancecode"),ae=ne.get("attendancetime"),se=ne.get("starttime"),re=ne.get("meetingid"),[ie,ce]=(0,r.useState)({});(0,r.useEffect)((()=>{if(ae)return ce({attendanceTime:ae,startTime:se}),O.A.remove("attendanceTime"),void O.A.remove("attendanceId");if(!te)return;(async()=>{U(!0);const[e,n]=await(0,f.A)("/attendance/","PUT",{attendancecode:te,meetingId:re,time:l()().format("h:mm:ss A")});e||402===n.error.errorCode?n.redirect?(window.location=n.redirect,O.A.set("attendanceTime",n.attendanceTime),O.A.set("attendanceId",n.attendanceId)):(U(!1),ce(n)):D(n.error)})()}),[te,re,e,ae,se]),(0,r.useEffect)((()=>{let e=null,n=null,a=null;if(!z||!c)return;const s=async n=>{n&&U(!0);const[a,s]=await(0,f.A)("/attendance/","POST",{id:c,set:n});if(!a)return D(s.error),H(!1),void clearInterval(e);N(s.attendees),T(s.absent),n&&(t(s.code),Q(L),U(!1))};return z&&(s(!0),e=setInterval((()=>s(!0)),1e3*L),n=setInterval((()=>s(!1)),1e3),a=setInterval((()=>Q((e=>e?e-1:e))),1e3)),()=>{clearInterval(e),clearInterval(n),clearInterval(a)}}),[z,c,e]);const le=async()=>{const e=(0,M.A)(),n=["Manual",W,$];N((t=>(0,a.A)((0,a.A)({},t),{},{[e]:n}))),X(""),_(!1),U(!0);const[t,s]=await(0,f.A)("/attendance/","PUT",{meetingId:c,attendee:n,attendeeId:e});U(!1),t||D(s.error)};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(i.mg,{children:[(0,I.jsx)("title",{children:"Attendance"}),(0,I.jsx)("meta",{name:"description",content:"Take attendance here"})]}),ie.attendanceTime&&ie.startTime||ie&&ie.error?(0,I.jsx)(k,(0,a.A)({},ie)):(0,I.jsxs)(x.A,{spacing:2,alignItems:"center",children:[(0,I.jsx)(h.A,{className:"min-h-[95%] w-[40%] min-w-[500px] mx-auto p-16 !rounded-[48px] mt-8",children:(0,I.jsxs)(x.A,{spacing:3,alignItems:"center",children:[(0,I.jsxs)(x.A,{direction:"row",justifyContent:"space-evenly",alignItems:"center",className:"w-full",children:[(0,I.jsx)(u.A,{label:"Meeting Name",disabled:z,value:V,onChange:e=>{B(e.target.value)},error:!V,required:!0}),(0,I.jsx)(m.$,{dateAdapter:o.R,children:(0,I.jsx)(d.A,{label:"Meeting Start Time",value:F,onChange:e=>{J(e)},renderInput:e=>(0,I.jsx)(u.A,(0,a.A)({},e)),disabled:z})})]}),z||G?G?(0,I.jsxs)(I.Fragment,{children:[0===G.length?(0,I.jsx)("p",{children:"No sessions found"}):G.map((e=>{let{_id:n,name:t}=e;return(0,I.jsx)(j.A,{onClick:()=>(async e=>{U(!0);const[n,t]=await(0,f.A)("/attendance/?query=".concat(e),"GET");n?(N(t.attendees),T(t.absent),U(!1)):D(t.error)})(n),children:t})})),(0,I.jsxs)(x.A,{direction:"row",gap:2,children:[(0,I.jsx)(j.A,{variant:"contained",onClick:ee,children:"Export to CSV"}),(0,I.jsx)(j.A,{variant:"contained",onClick:async()=>{const e={attendees:Object.values(b).map((e=>e[1])),absent:C};await navigator.clipboard.writeText(JSON.stringify(e))},children:"Copy"}),(0,I.jsx)(j.A,{variant:"contained",onClick:()=>{Y(void 0),N([]),T([])},children:"Back"})]})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("p",{className:"m-0 text-gray-500",children:["Code will change in ",K," second",1!==K?"s":""]}),(0,I.jsxs)("div",{style:{position:"relative",width:"300px",height:"300px"},children:[(0,I.jsx)(w.Xe,{id:"qrCode",value:"".concat(window.location,"/?attendancecode=").concat(n,"&meetingid=").concat(c),size:300,bgColor:"#ffffff",level:"H",style:{opacity:R?.5:1,transition:"opacity 0.3s ease-in-out"}}),R&&(0,I.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:(0,I.jsx)(p.A,{className:"text-[rgb(255,138,0)] !w-[50px] !h-[50px]"})})]}),(0,I.jsxs)(x.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,I.jsx)(j.A,{variant:"contained",onClick:Z,children:"Stop Session"}),(0,I.jsx)(j.A,{variant:"contained",onClick:ee,children:"Export to CSV"})]}),(0,I.jsxs)(x.A,{direction:"row",gap:4,alignItems:"center",children:[(0,I.jsx)(u.A,{label:"Add Attendee Manually",variant:"outlined",margin:"normal",fullWidth:!0,onChange:e=>X(e.target.value),value:W,onKeyDown:e=>{"Enter"===e.key&&le()}}),(0,I.jsx)(A.A,{control:(0,I.jsx)(g.A,{checked:$,onChange:e=>_(e.target.checked),name:"late"}),label:"Late"})]}),(0,I.jsx)(j.A,{variant:"contained",onClick:le,children:"Add Attendee"})]}):(0,I.jsxs)(x.A,{direction:"row",justifyContent:"space-evenly",alignItems:"center",className:"w-full",children:[(0,I.jsx)(j.A,{variant:"contained",onClick:Z,children:"Start Session"}),(0,I.jsx)(j.A,{variant:"contained",onClick:async()=>{U(!0);const[e,n]=await(0,f.A)("/attendance/?query=sessions","GET");if(!e)return D(n.error),void U(!1);Y(n.sessions),U(!1)},children:"View Previous Sessions"})]})]})}),(0,I.jsx)("div",{}),(z&&F||G)&&(0,I.jsx)(S,{attendees:b,startTime:F}),(z&&F||G)&&(0,I.jsx)(P,{absent:C})]}),q&&(0,I.jsx)(s.A,{open:!!q,error:q})]})}}}]);